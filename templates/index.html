{% extends "layout.html" %}

{% block content %}
<div class="mb-3">
  <!-- URL input formu (flex düzeni) -->
  <form action="{{ url_for('set_stream') }}" method="POST" class="mt-4">
    <!-- Tek satırda label, input ve buton, aynı yükseklik -->
    <div class="flex items-stretch gap-2">
      <label 
        for="stream_url" 
        class="flex items-center text-sm text-gray-600 whitespace-nowrap px-2 h-10">
        m3u8 URL:
      </label>
      <input
        id="stream_url"
        name="stream_url"
        type="text"
        placeholder="m3u8 URL giriniz"
        value="{{ stream_url }}"
        class="border rounded text-sm w-full h-10 px-2"
      />
      <button
        type="submit"
        class="bg-blue-600 text-white rounded text-sm h-10 px-3 hover:bg-blue-700">
        Akışı Güncelle
      </button>
    </div>
  </form>
</div>

<div class="flex flex-wrap lg:flex-nowrap gap-4">
  <!-- Sol Kolon (Video) -->
  <div class="w-full lg:w-3/4 bg-white rounded shadow p-4">
    <div class="mb-2">
      <img src="{{ url_for('video_feed') }}" alt="Video Akışı" class="w-full rounded shadow">
    </div>
  </div>

  <!-- Sağ Kolon (Bilgi Kartları) -->
  <div class="w-full lg:w-1/4 flex flex-col gap-4">
    <!-- Sayım Bilgisi Kartı -->
    <div class="bg-white rounded shadow p-4">
      <h3 class="text-lg font-semibold text-gray-700 mb-2">Sayım Bilgisi</h3>
      <table class="w-full text-sm text-gray-600">
        <tr class="border-b">
          <td class="py-1">Motor:</td>
          <td class="py-1 text-right" id="motor-count">0</td>
        </tr>
        <tr class="border-b">
          <td class="py-1">Araba:</td>
          <td class="py-1 text-right" id="car-count">0</td>
        </tr>
      </table>
      <!-- Sıfırlama butonu tam genişlikte (block) -->
      <form action="{{ url_for('reset_counts') }}" method="POST" class="mt-3">
        <button type="submit" 
                class="block w-full bg-red-600 text-white rounded py-1 text-sm text-center hover:bg-red-700">
          Sayımı Sıfırla
        </button>
      </form>
    </div>

    <!-- Bölge Kartı -->
    <div class="bg-white rounded shadow p-4">
      <h3 class="text-lg font-semibold text-gray-700 mb-2">Bölge</h3>
      <form action="#" method="POST" class="space-y-2">
        <div>
          <label for="city" class="block text-sm text-gray-600">İl</label>
          <input id="city" name="city" type="text" class="w-full border rounded px-2 py-1 text-sm">
        </div>
        <div>
          <label for="state" class="block text-sm text-gray-600">İlçe</label>
          <input id="state" name="state" type="text" class="w-full border rounded px-2 py-1 text-sm">
        </div>
        <button type="submit" disabled class="mt-3 w-full bg-blue-600 text-white rounded py-1 text-sm hover:bg-blue-700">
          Kaydet
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  async function fetchCounts() {
    try {
      let response = await fetch('/counts');
      let data = await response.json();
      document.getElementById('motor-count').textContent = data.motorcycle;
      document.getElementById('car-count').textContent = data.car;
    } catch (error) {
      console.error('Error fetching counts:', error);
    }
  }
  // Her 1 saniyede bir sayım bilgilerini güncelle
  setInterval(fetchCounts, 1000);
</script>
{% endblock %}
